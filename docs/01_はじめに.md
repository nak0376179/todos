# はじめに

## 1. 大方針

- ✅ AI の回答を得やすい設計で再構築したい（React/Vue + FastAPI）。
- ✅ フロントエンド、バックエンド、LocalStack はローカルで同時起動し、ホットリロードを駆使して高速開発できるようにしたい。
- ✅ Linter や Formatter を最大限活用し、コードの品質と一貫性を維持したい。
  - ✅ python3 は pylint ではなく ruff を採用して、ruff, black, mypy としたい。
- ✅ FastAPI の型定義から API のスキーマを自動設定し、フロントエンドの TanStackQuery の定義まで自動生成したい。
  - ✅ React の API の戻り値をすべて FastaPI 側で制御できるので、存在しない場合があってページがホワイトアウトするミスが出ない。
- ドキュメントはできるだけコードから生成する（コード解析で仕様が把握できる必要がある＆ドキュメントの乖離防止）。
- テストは自動テスト中心で構築し、コード・カバレッジを 85%以上にしたい。

---

## 2. 開発環境

- ✅ React/Vue + FastAPi を採用。AWS 環境は LocalStack で構築。全コンポーネントをホットリロード対応で同時起動。
- ✅ VS Code で開発環境を統一。`.vscode` により設定も均一化。保存時の自動整形に対応。

### バックエンド

- ✅ Python: 3.11.12 以上
- ✅ ツール: `poetry` + `pyenv` + `virtualenv`
- ✅ パッケージ: `fastapi` + `mangum` + `boto3`
- ✅ フォーマッタ: `ruff`
- ✅ Linter: `ruff`

### フロントエンド

- ✅ Node.js: v22 以上
- ✅ パッケージ: `React` + `Vite` + `MUI` / `Nuxt(Vue)` + `Vuetify`
- ✅ フォーマッタ: `prettier`
- ✅ Linter: `eslint`

---

## 3. API

- ✅ API 仕様は、バックエンドの `schemas` で定義。`models`は DynamoDB がスキーマレスなので使わない。
- ✅ 型定義・バリデーション・ドキュメントを自動化。
- ✅ `openapi-typescript` で TypeScript 型を生成。
- ✅ `openapi-react-query` により React Query 用の型安全な API 呼び出しを実現。

**参考**

- https://qiita.com/Tomato_otamoT/items/a4c00fef59b7cb866c2a
- https://openapi-ts.dev/
- https://openapi-ts.dev/openapi-react-query/

---

## 4. デザイン

- ✅ マテリアルデザイン指向

**参考**

- React: [MUI](https://mui.com/material-ui/)
- Vue: [Vuetify](https://vuetifyjs.com/ja/)
- ガイドライン: [Material 3](https://m3.material.io/)

---

## 5. 自動テスト戦略

### バックエンド

- ✅ ユニットテスト: `pytest` + `moto`（または LocalStack）
- ✅ 結合テスト: `pytest` + `LocalStack`

### フロントエンド

- ✅ ユニットテスト: `vitest`（UI を含まないロジック中心）
- ✅ 結合テスト: `vitest` + `storybook` + `msw v2`

### E2E

- `playwright`

---

## 6. ログ戦略

- リクエスト/レスポンスのグローバルミドルウェアログ
- リポジトリ層（DB・外部サービス）の前後にログ出力
- サービス層で詳細なドメインログを記録
- API 層で認証・認可ログ、バリデーションエラーログ

---

## 7. 認証・認可

---

## 8. セキュリティ

```
# Content Security Policy（例：自己ドメインとCDNのみ許可）
response.headers["Content-Security-Policy"] = "default-src 'self'; script-src 'self'"

# HSTS（HTTPS 強制）
response.headers["Strict-Transport-Security"] = "max-age=63072000; includeSubDomains; preload"

# XSS 対策
response.headers["X-XSS-Protection"] = "1; mode=block"

# Clickjacking 対策
response.headers["X-Frame-Options"] = "DENY"

# MIME-type スニッフィング防止
response.headers["X-Content-Type-Options"] = "nosniff"

# Referrer ポリシー
response.headers["Referrer-Policy"] = "no-referrer"
```

---

## 9. rate limiting（例: slowapi ライブラリ）
